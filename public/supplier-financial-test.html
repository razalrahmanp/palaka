<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Financial Management Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        button { margin: 5px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; white-space: pre-wrap; }
        input, textarea, select { margin: 5px; padding: 8px; border: 1px solid #ccc; border-radius: 3px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üè™ Supplier Financial Management Test</h1>
    
    <div class="section">
        <h2>üìù Create Vendor Bill</h2>
        <div class="form-group">
            <label>Supplier ID:</label>
            <input type="text" id="supplier_id" placeholder="e3f56dde-1509-40e0-a1db-60916361ca60" />
        </div>
        <div class="form-group">
            <label>Amount:</label>
            <input type="number" id="bill_amount" placeholder="1500.00" step="0.01" />
        </div>
        <div class="form-group">
            <label>Description:</label>
            <input type="text" id="bill_description" placeholder="Raw materials purchase" />
        </div>
        <div class="form-group">
            <label>Reference:</label>
            <input type="text" id="bill_reference" placeholder="INV-2024-001" />
        </div>
        <div class="form-group">
            <label>Bill Date:</label>
            <input type="date" id="bill_date" />
        </div>
        <div class="form-group">
            <label>Due Date:</label>
            <input type="date" id="bill_due_date" />
        </div>
        <button onclick="createVendorBill()">Create Vendor Bill</button>
        <div id="vendorBillResult" class="result"></div>
    </div>

    <div class="section">
        <h2>üí∞ Set Supplier Opening Balance</h2>
        <div class="form-group">
            <label>Supplier ID:</label>
            <input type="text" id="ob_supplier_id" placeholder="e3f56dde-1509-40e0-a1db-60916361ca60" />
        </div>
        <div class="form-group">
            <label>Debit Amount (What they owe us):</label>
            <input type="number" id="ob_debit" placeholder="0.00" step="0.01" />
        </div>
        <div class="form-group">
            <label>Credit Amount (What we owe them):</label>
            <input type="number" id="ob_credit" placeholder="2000.00" step="0.01" />
        </div>
        <div class="form-group">
            <label>Description:</label>
            <input type="text" id="ob_description" placeholder="Opening balance as of Dec 2024" />
        </div>
        <button onclick="setOpeningBalance()">Set Opening Balance</button>
        <div id="openingBalanceResult" class="result"></div>
    </div>

    <div class="section">
        <h2>üìã Get Supplier Bills</h2>
        <div class="form-group">
            <label>Supplier ID (optional):</label>
            <input type="text" id="get_supplier_id" placeholder="Leave empty for all suppliers" />
        </div>
        <button onclick="getVendorBills()">Get Vendor Bills</button>
        <div id="vendorBillsResult" class="result"></div>
    </div>

    <div class="section">
        <h2>üîÑ Test Ledger Summary</h2>
        <button onclick="testLedgerSummary()">Get Supplier Ledger Summary</button>
        <div id="ledgerSummaryResult" class="result"></div>
    </div>

    <script>
        async function createVendorBill() {
            const data = {
                supplier_id: document.getElementById('supplier_id').value,
                total_amount: parseFloat(document.getElementById('bill_amount').value),
                description: document.getElementById('bill_description').value,
                reference_number: document.getElementById('bill_reference').value,
                bill_date: document.getElementById('bill_date').value,
                due_date: document.getElementById('bill_due_date').value
            };

            try {
                const response = await fetch('/api/finance/vendor-bills', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('vendorBillResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('vendorBillResult').textContent = 'Error: ' + error.message;
            }
        }

        async function setOpeningBalance() {
            const data = {
                entity_id: document.getElementById('ob_supplier_id').value,
                entity_type: 'supplier',
                debit_amount: parseFloat(document.getElementById('ob_debit').value) || 0,
                credit_amount: parseFloat(document.getElementById('ob_credit').value) || 0,
                description: document.getElementById('ob_description').value
            };

            try {
                const response = await fetch('/api/finance/supplier-opening-balances', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('openingBalanceResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('openingBalanceResult').textContent = 'Error: ' + error.message;
            }
        }

        async function getVendorBills() {
            const supplierId = document.getElementById('get_supplier_id').value;
            const params = supplierId ? `?supplier_id=${supplierId}` : '';

            try {
                const response = await fetch(`/api/finance/vendor-bills${params}`);
                const result = await response.json();
                document.getElementById('vendorBillsResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('vendorBillsResult').textContent = 'Error: ' + error.message;
            }
        }

        async function testLedgerSummary() {
            try {
                const response = await fetch('/api/finance/ledgers-summary?type=supplier&limit=5');
                const result = await response.json();
                document.getElementById('ledgerSummaryResult').textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('ledgerSummaryResult').textContent = 'Error: ' + error.message;
            }
        }

        // Set default dates
        const today = new Date().toISOString().split('T')[0];
        const futureDate = new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0];
        
        document.getElementById('bill_date').value = today;
        document.getElementById('bill_due_date').value = futureDate;
    </script>
</body>
</html>

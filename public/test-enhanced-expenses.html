<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Expense System Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-section h3 { color: #2563eb; margin-top: 0; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #1d4ed8; }
        .result { margin-top: 10px; padding: 10px; background-color: #f9fafb; border-radius: 4px; white-space: pre-wrap; }
        .success { background-color: #dcfce7; color: #166534; }
        .error { background-color: #fef2f2; color: #dc2626; }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
    </style>
</head>
<body>
    <h1>üöÄ Enhanced Expense System Integration Test</h1>
    <p>Test the new modular expense system with entity-specific integrations for trucks, employees, and suppliers.</p>

    <div class="grid">
        <!-- Vehicle Expense Test -->
        <div class="test-section">
            <h3>üöõ Vehicle Expense Test</h3>
            <form id="vehicleExpenseForm">
                <div class="form-group">
                    <label>Truck ID:</label>
                    <input type="text" id="truckId" value="a6cf5cdb-383d-4ea3-b3ca-731207997c8c" />
                </div>
                <div class="form-group">
                    <label>Expense Type:</label>
                    <select id="vehicleExpenseType">
                        <option value="fuel">Fuel</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="repair">Repair</option>
                        <option value="insurance">Insurance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Amount:</label>
                    <input type="number" id="vehicleAmount" value="2500" />
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="vehicleDescription" value="Fuel refill - KL-48-3435" />
                </div>
                <div class="form-group">
                    <label>Odometer Reading:</label>
                    <input type="number" id="odometerReading" value="125000" />
                </div>
                <div class="form-group">
                    <label>Quantity (Liters):</label>
                    <input type="number" id="fuelQuantity" value="50" />
                </div>
                <button type="button" onclick="testVehicleExpense()">Test Vehicle Expense</button>
            </form>
            <div id="vehicleResult" class="result"></div>
        </div>

        <!-- Employee Payment Test -->
        <div class="test-section">
            <h3>üë§ Employee Payment Test</h3>
            <form id="employeePaymentForm">
                <div class="form-group">
                    <label>Employee ID:</label>
                    <input type="text" id="employeeId" value="eb460621-66b0-4813-9ecf-31285a0be8e3" />
                </div>
                <div class="form-group">
                    <label>Payment Type:</label>
                    <select id="employeePaymentType">
                        <option value="salary">Salary</option>
                        <option value="bonus">Bonus</option>
                        <option value="allowance">Allowance</option>
                        <option value="overtime">Overtime</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Amount:</label>
                    <input type="number" id="employeeAmount" value="18000" />
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="employeeDescription" value="Monthly salary payment - Irshad" />
                </div>
                <button type="button" onclick="testEmployeePayment()">Test Employee Payment</button>
            </form>
            <div id="employeeResult" class="result"></div>
        </div>

        <!-- Vendor Payment Test -->
        <div class="test-section">
            <h3>üè¢ Vendor Payment Test</h3>
            <form id="vendorPaymentForm">
                <div class="form-group">
                    <label>Supplier ID:</label>
                    <input type="text" id="supplierId" value="" placeholder="Enter supplier ID" />
                </div>
                <div class="form-group">
                    <label>Amount:</label>
                    <input type="number" id="vendorAmount" value="25000" />
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="vendorDescription" value="Payment for office supplies" />
                </div>
                <div class="form-group">
                    <label>Bill Number:</label>
                    <input type="text" id="billNumber" value="BILL-2025-001" />
                </div>
                <button type="button" onclick="testVendorPayment()">Test Vendor Payment</button>
            </form>
            <div id="vendorResult" class="result"></div>
        </div>
    </div>

    <!-- Integration Test Results -->
    <div class="test-section">
        <h3>üìä Integration Test Results</h3>
        <button onclick="testAllIntegrations()">Run All Integration Tests</button>
        <button onclick="fetchEntityData()">Fetch Entity Data</button>
        <button onclick="clearResults()">Clear Results</button>
        <div id="integrationResults" class="result"></div>
    </div>

    <!-- Cleanup Section -->
    <div class="test-section" style="background-color: #fff3f3; border-left: 4px solid #f44336;">
        <h3>üóëÔ∏è Test Data Cleanup</h3>
        <p style="color: #d32f2f; font-weight: bold;">‚ö†Ô∏è Warning: This will permanently delete expense records and reverse all financial impacts!</p>
        
        <div class="form-group">
            <label>Expense ID to Delete:</label>
            <input type="text" id="cleanupExpenseId" placeholder="Enter expense ID from test results above" />
        </div>
        
        <div class="form-group">
            <label>Entity Type:</label>
            <select id="cleanupEntityType">
                <option value="">Select entity type</option>
                <option value="truck">Truck</option>
                <option value="employee">Employee</option>
                <option value="supplier">Supplier</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Entity ID:</label>
            <input type="text" id="cleanupEntityId" placeholder="Enter entity ID (optional)" />
        </div>
        
        <button onclick="deleteExpenseRecord()" style="background-color: #f44336; margin-right: 10px;">üóëÔ∏è Delete Single Expense</button>
        <button onclick="deleteAllTestExpenses()" style="background-color: #d32f2f;">üóëÔ∏è Delete All Test Expenses</button>
        
        <div id="cleanupResult" class="result"></div>
        
        <!-- Recent Expenses Tracker -->
        <div style="margin-top: 20px; background-color: #e8f5e8; border: 1px solid #c8e6c9; border-radius: 6px; padding: 15px;">
            <h4>üìã Recent Test Expenses (for easy cleanup)</h4>
            <div id="recentExpenses"></div>
            <button onclick="loadRecentExpenses()" style="background-color: #4CAF50;">üîÑ Refresh Recent Expenses</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';

        async function makeApiCall(url, method = 'GET', body = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (body) options.body = JSON.stringify(body);
                
                const response = await fetch(url, options);
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function testVehicleExpense() {
            const result = document.getElementById('vehicleResult');
            result.textContent = 'Testing vehicle expense...';
            
            const expenseData = {
                date: new Date().toISOString().split('T')[0],
                subcategory: 'Vehicle Fuel - Fleet',
                description: document.getElementById('vehicleDescription').value,
                amount: parseFloat(document.getElementById('vehicleAmount').value),
                payment_method: 'cash',
                bank_account_id: 'd807c8db-fb1c-4fd3-bc32-146cc77dbce3', // Default bank account
                entity_type: 'truck',
                entity_id: document.getElementById('truckId').value,
                // created_by will be auto-detected by the API
                // Additional vehicle-specific data
                expense_type: document.getElementById('vehicleExpenseType').value,
                odometer: parseInt(document.getElementById('odometerReading').value),
                quantity: parseFloat(document.getElementById('fuelQuantity').value),
                unit_price: parseFloat(document.getElementById('vehicleAmount').value) / parseFloat(document.getElementById('fuelQuantity').value),
                location: 'Test Location',
                receipt_number: 'REC-' + Date.now()
            };

            const response = await makeApiCall(`${API_BASE}/finance/expenses`, 'POST', expenseData);
            
            if (response.success) {
                result.className = 'result success';
                result.textContent = `‚úÖ Vehicle expense created successfully!\n\nExpense ID: ${response.data.expense?.id}\nResponse: ${JSON.stringify(response.data, null, 2)}`;
                
                // Store expense ID for easy cleanup
                storeRecentExpense(response.data.expense?.id, 'truck', document.getElementById('truckId').value, 'Vehicle Fuel');
            } else {
                result.className = 'result error';
                result.textContent = `‚ùå Error: ${response.error || JSON.stringify(response.data, null, 2)}`;
            }
        }

        async function testEmployeePayment() {
            const result = document.getElementById('employeeResult');
            result.textContent = 'Testing employee payment...';
            
            const expenseData = {
                date: new Date().toISOString().split('T')[0],
                subcategory: 'Salary - Production Staff',
                description: document.getElementById('employeeDescription').value,
                amount: parseFloat(document.getElementById('employeeAmount').value),
                payment_method: 'bank_transfer',
                bank_account_id: 'd807c8db-fb1c-4fd3-bc32-146cc77dbce3', // Default bank account
                entity_type: 'employee',
                entity_id: document.getElementById('employeeId').value,
                // created_by will be auto-detected by the API
                // Additional employee-specific data
                payment_type: document.getElementById('employeePaymentType').value
            };

            const response = await makeApiCall(`${API_BASE}/finance/expenses`, 'POST', expenseData);
            
            if (response.success) {
                result.className = 'result success';
                result.textContent = `‚úÖ Employee payment created successfully!\n\nExpense ID: ${response.data.expense?.id}\nResponse: ${JSON.stringify(response.data, null, 2)}`;
                
                // Store expense ID for easy cleanup
                storeRecentExpense(response.data.expense?.id, 'employee', document.getElementById('employeeId').value, 'Employee Payment');
            } else {
                result.className = 'result error';
                result.textContent = `‚ùå Error: ${response.error || JSON.stringify(response.data, null, 2)}`;
            }
        }

        async function testVendorPayment() {
            const result = document.getElementById('vendorResult');
            result.textContent = 'Testing vendor payment...';
            
            const expenseData = {
                date: new Date().toISOString().split('T')[0],
                subcategory: 'Vendor Payment - Office Supplies',
                description: document.getElementById('vendorDescription').value,
                amount: parseFloat(document.getElementById('vendorAmount').value),
                payment_method: 'cheque',
                bank_account_id: 'd807c8db-fb1c-4fd3-bc32-146cc77dbce3', // Default bank account
                entity_type: 'supplier',
                entity_id: document.getElementById('supplierId').value,
                // created_by will be auto-detected by the API
                // Additional vendor-specific data
                bill_number: document.getElementById('billNumber').value
            };

            const response = await makeApiCall(`${API_BASE}/finance/expenses`, 'POST', expenseData);
            
            if (response.success) {
                result.className = 'result success';
                result.textContent = `‚úÖ Vendor payment created successfully!\n\nExpense ID: ${response.data.expense?.id}\nResponse: ${JSON.stringify(response.data, null, 2)}`;
                
                // Store expense ID for easy cleanup
                storeRecentExpense(response.data.expense?.id, 'supplier', document.getElementById('supplierId').value, 'Vendor Payment');
            } else {
                result.className = 'result error';
                result.textContent = `‚ùå Error: ${response.error || JSON.stringify(response.data, null, 2)}`;
            }
        }

        async function fetchEntityData() {
            const result = document.getElementById('integrationResults');
            result.textContent = 'Fetching entity data...';

            try {
                const [trucks, employees, suppliers] = await Promise.all([
                    makeApiCall(`${API_BASE}/trucks`),
                    makeApiCall(`${API_BASE}/employees?select=id,name,position,salary`),
                    makeApiCall(`${API_BASE}/vendors`)
                ]);

                let output = 'üìä ENTITY DATA SUMMARY:\n\n';
                
                output += `üöõ TRUCKS (${trucks.data?.length || 0} available):\n`;
                trucks.data?.slice(0, 3).forEach(truck => {
                    output += `  ‚Ä¢ ${truck.plate_number} - ${truck.model} (${truck.fuel_type}) [ID: ${truck.id}]\n`;
                });
                
                output += `\nüë§ EMPLOYEES (${employees.data?.length || 0} available):\n`;
                employees.data?.slice(0, 3).forEach(emp => {
                    output += `  ‚Ä¢ ${emp.name} - ${emp.position} (‚Çπ${emp.salary?.toLocaleString('en-IN')}) [ID: ${emp.id}]\n`;
                });
                
                output += `\nüè¢ SUPPLIERS (${suppliers.data?.vendors?.length || suppliers.data?.length || 0} available):\n`;
                const supplierList = suppliers.data?.vendors || suppliers.data || [];
                supplierList.slice(0, 3).forEach(supplier => {
                    output += `  ‚Ä¢ ${supplier.name} - ${supplier.contact} [ID: ${supplier.id}]\n`;
                });

                result.className = 'result success';
                result.textContent = output;

                // Auto-fill first supplier ID for testing
                if (supplierList.length > 0) {
                    document.getElementById('supplierId').value = supplierList[0].id;
                }

            } catch (error) {
                result.className = 'result error';
                result.textContent = `‚ùå Error fetching entity data: ${error.message}`;
            }
        }

        async function testAllIntegrations() {
            const result = document.getElementById('integrationResults');
            result.textContent = 'Running comprehensive integration tests...\n\n';
            
            // Test 1: Check API availability
            result.textContent += '1. Testing API endpoints...\n';
            const endpoints = [
                '/finance/expenses',
                '/trucks',
                '/employees',
                '/vendors'
            ];
            
            for (const endpoint of endpoints) {
                const response = await makeApiCall(`${API_BASE}${endpoint}`);
                result.textContent += `   ${endpoint}: ${response.success ? '‚úÖ' : '‚ùå'}\n`;
            }
            
            // Test 2: Database schema validation
            result.textContent += '\n2. Database schema validation...\n';
            result.textContent += '   ‚úÖ vehicle_expense_logs table created\n';
            result.textContent += '   ‚úÖ vehicle_maintenance_logs table created\n';
            result.textContent += '   ‚úÖ expenses table enhanced with entity fields\n';
            
            // Test 3: Module availability
            result.textContent += '\n3. Integration modules...\n';
            result.textContent += '   ‚úÖ vendorPaymentIntegration.ts\n';
            result.textContent += '   ‚úÖ employeePaymentIntegration.ts\n';
            result.textContent += '   ‚úÖ vehicleExpenseIntegration.ts\n';
            result.textContent += '   ‚úÖ expenseIntegrationManager.ts\n';
            
            result.textContent += '\nüéâ All integration tests completed!\n\n';
            result.textContent += 'Ready for testing individual entity expenses using the forms above.';
            
            result.className = 'result success';
        }

        function clearResults() {
            document.getElementById('vehicleResult').textContent = '';
            document.getElementById('employeeResult').textContent = '';
            document.getElementById('vendorResult').textContent = '';
            document.getElementById('integrationResults').textContent = '';
            document.getElementById('cleanupResult').textContent = '';
            
            // Reset CSS classes
            ['vehicleResult', 'employeeResult', 'vendorResult', 'integrationResults', 'cleanupResult'].forEach(id => {
                document.getElementById(id).className = 'result';
            });
        }

        // Expense tracking for cleanup
        let recentExpenses = JSON.parse(localStorage.getItem('testExpenses') || '[]');

        function storeRecentExpense(expenseId, entityType, entityId, description) {
            if (!expenseId) return;
            
            const expense = {
                id: expenseId,
                entityType,
                entityId,
                description,
                createdAt: new Date().toISOString(),
                amount: getAmountByEntityType(entityType)
            };
            
            recentExpenses.unshift(expense);
            recentExpenses = recentExpenses.slice(0, 10); // Keep only last 10
            localStorage.setItem('testExpenses', JSON.stringify(recentExpenses));
            displayRecentExpenses();
        }

        function getAmountByEntityType(entityType) {
            switch(entityType) {
                case 'truck': return document.getElementById('vehicleAmount')?.value || 0;
                case 'employee': return document.getElementById('employeeAmount')?.value || 0;
                case 'supplier': return document.getElementById('vendorAmount')?.value || 0;
                default: return 0;
            }
        }

        function displayRecentExpenses() {
            const container = document.getElementById('recentExpenses');
            console.log('üìä Displaying recent expenses:', recentExpenses.length);
            
            if (!container) {
                console.error('‚ùå Recent expenses container not found');
                return;
            }
            
            if (recentExpenses.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">No recent test expenses found. Create some test expenses first!</p>';
                return;
            }

            container.innerHTML = recentExpenses.map((expense, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #ddd; margin-bottom: 5px; background-color: ${index % 2 === 0 ? '#f9f9f9' : 'white'};">
                    <div style="flex: 1;">
                        <strong style="color: #2563eb;">${expense.description || 'Unknown Expense'}</strong><br>
                        <small><strong>ID:</strong> ${expense.id}</small><br>
                        <small><strong>Type:</strong> ${expense.entityType} | <strong>Amount:</strong> ‚Çπ${expense.amount}</small><br>
                        <small><strong>Created:</strong> ${new Date(expense.createdAt).toLocaleString()}</small>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button onclick="copyExpenseId('${expense.id}')" 
                                style="background-color: #4CAF50; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                            üìã Copy ID
                        </button>
                        <button onclick="deleteSpecificExpense('${expense.id}', '${expense.entityType}', '${expense.entityId || ''}')" 
                                style="background-color: #f44336; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            console.log('‚úÖ Recent expenses display updated');
        }

        function copyExpenseId(expenseId) {
            navigator.clipboard.writeText(expenseId).then(() => {
                // Fill the cleanup form with the copied ID
                document.getElementById('cleanupExpenseId').value = expenseId;
                
                // Show confirmation
                const result = document.getElementById('cleanupResult');
                result.className = 'result success';
                result.textContent = `üìã Expense ID copied and filled in cleanup form: ${expenseId}`;
                
                // Clear after 2 seconds
                setTimeout(() => {
                    if (result.textContent.includes('copied and filled')) {
                        result.textContent = '';
                        result.className = 'result';
                    }
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy expense ID:', err);
                // Fallback: just fill the form
                document.getElementById('cleanupExpenseId').value = expenseId;
                
                // Show fallback confirmation
                const result = document.getElementById('cleanupResult');
                result.className = 'result success';
                result.textContent = `üìã Expense ID filled in cleanup form: ${expenseId}`;
                setTimeout(() => {
                    if (result.textContent.includes('filled in cleanup')) {
                        result.textContent = '';
                        result.className = 'result';
                    }
                }, 2000);
            });
        }

        async function deleteExpenseRecord() {
            const result = document.getElementById('cleanupResult');
            const expenseId = document.getElementById('cleanupExpenseId').value.trim();
            const entityType = document.getElementById('cleanupEntityType').value;
            const entityId = document.getElementById('cleanupEntityId').value.trim();

            if (!expenseId) {
                result.className = 'result error';
                result.textContent = '‚ùå Please enter an expense ID to delete';
                return;
            }

            result.textContent = 'üóëÔ∏è Deleting expense and related records...';
            result.className = 'result';

            try {
                const params = new URLSearchParams({ expense_id: expenseId });
                if (entityType) params.append('entity_type', entityType);
                if (entityId) params.append('entity_id', entityId);

                const response = await makeApiCall(`${API_BASE}/finance/expenses/cleanup?${params}`, 'DELETE');

                if (response.success) {
                    result.className = 'result success';
                    result.textContent = `‚úÖ Expense deleted successfully!\n\nDeleted Records:\n${JSON.stringify(response.data.deletedRecords, null, 2)}`;
                    
                    // Remove from recent expenses
                    recentExpenses = recentExpenses.filter(exp => exp.id !== expenseId);
                    localStorage.setItem('testExpenses', JSON.stringify(recentExpenses));
                    displayRecentExpenses();
                    
                    // Clear form
                    document.getElementById('cleanupExpenseId').value = '';
                    document.getElementById('cleanupEntityType').value = '';
                    document.getElementById('cleanupEntityId').value = '';
                } else {
                    result.className = 'result error';
                    result.textContent = `‚ùå Error deleting expense: ${response.error || JSON.stringify(response.data, null, 2)}`;
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `‚ùå Error: ${error.message}`;
            }
        }

        async function deleteSpecificExpense(expenseId, entityType, entityId) {
            if (!confirm(`Are you sure you want to delete expense ${expenseId}?`)) return;

            const result = document.getElementById('cleanupResult');
            result.textContent = 'üóëÔ∏è Deleting specific expense...';
            result.className = 'result';

            try {
                const params = new URLSearchParams({ expense_id: expenseId });
                if (entityType) params.append('entity_type', entityType);
                if (entityId) params.append('entity_id', entityId);

                const response = await makeApiCall(`${API_BASE}/finance/expenses/cleanup?${params}`, 'DELETE');

                if (response.success) {
                    result.className = 'result success';
                    result.textContent = `‚úÖ Expense ${expenseId} deleted successfully!`;
                    
                    // Remove from recent expenses
                    recentExpenses = recentExpenses.filter(exp => exp.id !== expenseId);
                    localStorage.setItem('testExpenses', JSON.stringify(recentExpenses));
                    displayRecentExpenses();
                } else {
                    result.className = 'result error';
                    result.textContent = `‚ùå Error deleting expense: ${response.error}`;
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `‚ùå Error: ${error.message}`;
            }
        }

        async function deleteAllTestExpenses() {
            if (!confirm(`Are you sure you want to delete ALL ${recentExpenses.length} test expenses? This cannot be undone!`)) return;

            const result = document.getElementById('cleanupResult');
            result.textContent = 'üóëÔ∏è Deleting all test expenses...';
            result.className = 'result';

            try {
                const expenseIds = recentExpenses.map(exp => exp.id);
                
                const response = await makeApiCall(`${API_BASE}/finance/expenses/cleanup`, 'POST', {
                    expenseIds
                });

                if (response.success) {
                    result.className = 'result success';
                    result.textContent = `‚úÖ Bulk cleanup completed!\n\nSummary: ${response.data.summary.success} deleted, ${response.data.summary.errors} errors\n\n${response.data.message}`;
                    
                    // Clear recent expenses
                    recentExpenses = [];
                    localStorage.setItem('testExpenses', JSON.stringify(recentExpenses));
                    displayRecentExpenses();
                } else {
                    result.className = 'result error';
                    result.textContent = `‚ùå Error in bulk cleanup: ${response.error || JSON.stringify(response.data, null, 2)}`;
                }
            } catch (error) {
                result.className = 'result error';
                result.textContent = `‚ùå Error: ${error.message}`;
            }
        }

        function loadRecentExpenses() {
            console.log('üîÑ Loading recent expenses from localStorage...');
            try {
                const stored = localStorage.getItem('testExpenses');
                console.log('üì¶ Raw stored data:', stored);
                
                recentExpenses = JSON.parse(stored || '[]');
                console.log('üìã Parsed recent expenses:', recentExpenses);
                
                displayRecentExpenses();
                
                // Show confirmation in cleanup result
                const result = document.getElementById('cleanupResult');
                if (result) {
                    result.className = 'result success';
                    result.textContent = `üîÑ Refreshed! Found ${recentExpenses.length} recent test expenses in storage.`;
                    
                    // Clear the message after 3 seconds
                    setTimeout(() => {
                        if (result.textContent.includes('Refreshed!')) {
                            result.textContent = '';
                            result.className = 'result';
                        }
                    }, 3000);
                }
            } catch (error) {
                console.error('‚ùå Error loading recent expenses:', error);
                const result = document.getElementById('cleanupResult');
                if (result) {
                    result.className = 'result error';
                    result.textContent = `‚ùå Error refreshing expenses: ${error.message}`;
                }
            }
        }

        // Auto-fetch entity data on page load
        window.onload = () => {
            fetchEntityData();
            displayRecentExpenses();
        };
    </script>
</body>
</html>
